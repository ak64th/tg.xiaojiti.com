{% extends "layout.html" %}

{% block title %}<title>团购助手-我是团员</title>{% endblock %}

{% block body %}
<div id="group_view_container" style="display: none">
  <div class="block-menu clear" id="group_list_container">
    <script type="text/template" id="group_list_template">
      <a class="
      <% if (index % 6 === 0) { %>
      menu1 menu-big fl
      <% } else if(index % 6 === 1) { %>
      menu2 fr
      <% } else if(index % 6 === 2) { %>
      menu3 fr
      <% } else if(index % 6 === 3) { %>
      menu4 menu-big fr
      <% } else if(index % 6 === 4) { %>
      menu5 fl
      <% } else if(index % 6 === 5) { %>
      menu6 fl
      <% } %>" id="group_<%= group.id %>" href="#/group/<%= group.id %>/"><img
          src="/static/img/menu-cai-icon.png"><span><%- group.title %></span></a></a>
    </script>
  </div>
</div>

<script type="text/template" id="purchase_panel_template">
  <div class="goods-footer-bar clear">
    <a class="checkbox fl all-toggle">全选</a>

    <div class="fl count"></div>
    <div class="fr goods-list-btns">
      <a class="btn2 submit"></a>
      <a class="btn3 summary"></a>
    </div>
  </div>
</script>


{% endblock body %}

{% block script %}
{{ super() }}
{% assets "member_js" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
<script>
var wxUser = {{ wx_user_data|safe }}

groupView = new int_app.View.GroupListView();



// 路由，默认到groupList
appRouter = Backbone.Router.extend({
  routes: {
    "group/":     "groupList",
    "group/:id/": "purchaseList",
    "group/:id/summary/": "groupSummary",
    "*path":      "groupList"
  },
  groupList : function(path) {
    console.log('group detail route triggered. path:' + path);
    this.loadView(groupView);
  },
  purchaseList : function(id) {
    console.log('group purchase list route triggered. id:' + id);
    this.loadView(new int_app.View.PurchaseListView({wx_user_id: wxUser.id, group_id: id}));
  },
  groupSummary : function(id) {
    console.log('group summary route triggered. id:' + id);
    this.loadView(new int_app.View.GroupSummaryView({group_id: id}));
  },
  loadView : function(view) {
		this.view && (this.view.close ? this.view.close() : this.view.remove());
		this.view = view;
		this.view.render();
	}
});

var router = new appRouter();
Backbone.history.start();



</script>
{% endblock script %}
