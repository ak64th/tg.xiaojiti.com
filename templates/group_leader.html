{% extends "layout.html" %}

{% block title %}<title>团购助手-我是团长</title>{% endblock %}

{% block body %}
<div id="group_view_container" style="display: none">
  <div id="modal-container" style="display: none">
    <div class="btn-create-group-tips-bg"></div>
    <div class="pop-alert">
      <div class="txt">请给您的团一个好记忆的名称，譬如说是小集体大白菜团，也可以叫做老班我要买酒</div>
      <input class="input" type="text" id="group_add_title">

      <div class="clear pop-btn">
        <a href="#" id="group_add_cancel" class="fl">Cancel</a>
        <a href="#" id="group_add_submit" class="fr">OK</a>
      </div>
    </div>
  </div>

  <div class="block-menu clear" id="group_list_container" style="margin-bottom:60px">
    <script type="text/template" id="group_list_template">
      <a class="
      <% if (index % 6 === 0) { %>
      menu1 menu-big fl
      <% } else if(index % 6 === 1) { %>
      menu2 fr
      <% } else if(index % 6 === 2) { %>
      menu3 fr
      <% } else if(index % 6 === 3) { %>
      menu4 menu-big fr
      <% } else if(index % 6 === 4) { %>
      menu5 fl
      <% } else if(index % 6 === 5) { %>
      menu6 fl
      <% } %>" id="group_<%= group.id %>" href="#/group/<%= group.id %>/"><img
          src="/static/img/menu-cai-icon.png"><span><%- group.title %></span></a></a>
    </script>
  </div>
  <div class="btn-create-group-fixed-bg"></div>
  <a href="#" class="btn-create-group btn-create-group-fixed" id="group_add">添加新的商品</a>
</div>

<script type="text/template" id="product_template">
  <img src="/static/img/goods-cover.png" class="cover fl">
  <div class="txt fl">
    <input class="btn editable" data-field="title" value="<%- product.title %>"/>

    <div class="textarea-wp">
      <textarea class="editable" data-field="content" placeholder="商品说明"><%- product.content %></textarea>
    </div>
  </div>
  <div class="price fr">
    <input class="editable price-tag" data-field="price" value="<%= product.price %>" size="6" type="text"/>元
    <div class="btn">点击修改价格</div>
  </div>
</script>

<script type="text/template" id="group_summary_template">
  <div class="cover">
    <img src="{{ url_for('static', filename='img/tmp.png') }}" class="banner">
    <div class="bg"></div>
    <div class="txt"><%= products[0].title %><span class="r"><span class="num"><%= products[0].price %></span>元</span></div>
  </div>
  <div class="clear circle">
    <div class="fl circle-blue">
      <span class="l">一共有</span>
      <span class="m"><%= members.length %></span>
      <span class="r">位朋友</span>
    </div>
    <div class="fr">
      <span class="l">共计</span>
      <span class="m"><%= total %></span>
      <span class="r">元</span>
    </div>
  </div>
  <div class="member-block clear">
    <i></i>
    <% _.each(members, function(member){ %>
    <div class="member">
      <img src="{{ url_for('static', filename='img/avatar2.png') }}" class="avatar">
      <span class="nick">购买数量:<span class="num"><%= member.amount %></span></span>
    </div>
    <% }); %>
  </div>
</script>

{% endblock body %}

{% block script %}
{{ super() }}
{% assets "leader_js" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
<script>
//var wxUser = new int_app.Model.WxUserModel
//wxUser.fetch({data: {openid: '{{ openid }}'}, async: false})
var wxUser = {{ wx_user_data|safe }}

groupView = new int_app.View.GroupListView({wxUser: wxUser});

// 路由，默认到groupList
appRouter = Backbone.Router.extend({
  routes: {
    "group/":     "groupList",
    "group/:id/": "productList",
    "group/:id/summary/": "groupSummary",
    "*path":      "groupList"
  },
  groupList : function(path) {
    console.log('group detail route triggered. path:' + path);
    this.loadView(groupView);
  },
  productList : function(id) {
    console.log('group product list route triggered. id:' + id);
    this.loadView(new int_app.View.ProductListView({group_id: id}));
  },
  groupSummary : function(id) {
    console.log('group summary route triggered. id:' + id);
    this.loadView(new int_app.View.GroupSummaryView({group_id: id}));
  },
  loadView : function(view) {
		this.view && (this.view.close ? this.view.close() : this.view.remove());
		this.view = view;
		this.view.render();
	}
});

var router = new appRouter();
Backbone.history.start();

</script>

{% endblock script %}
